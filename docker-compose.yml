services:
  manual:
    build:
      context: .
      target: production # Multi-stage buildã®production stage
      cache_from:
        - manual-generator:latest
    image: manual-generator:latest
    container_name: manual-generator
    ports:
      - "8080:5000"
    environment:
      PYTHONUNBUFFERED: "1"
      PORT: "5000"
      LOG_DIR: /logs
      GOOGLE_APPLICATION_CREDENTIALS: /app/gcp-credentials.json
      DATABASE_PATH: /instance/manual_generator.db
    env_file:
      - .env
    volumes:
      - ./logs:/logs
      - ./instance:/instance
      - manual_uploads:/app/uploads
    command: >
      bash -c "
      chmod +x /app/startup.sh &&
      /app/startup.sh
      "

volumes:
  manual_uploads: {}

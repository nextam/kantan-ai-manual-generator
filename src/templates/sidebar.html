<div class="sidebar">
    <div class="sidebar-header">
        <h2>マニュアル生成システム</h2>
        <div class="user-info">
            {% if current_user.is_authenticated %}
                {% if session.get('is_super_admin') %}
                    <div><strong>スーパー管理者</strong></div>
                    <div>{{ session.get('super_admin_username', current_user.username) }}</div>
                {% elif session.get('company_id') %}
                    <div><strong>{{ session.get('username', current_user.username) }}</strong></div>
                    <div>{{ session.get('company_name', '企業') }}</div>
                    {% if session.get('user_role') %}
                        <div style="font-size: 11px; margin-top: 3px;">
                            {% if session.get('user_role') == 'admin' %}
                                企業管理者
                            {% else %}
                                一般ユーザー
                            {% endif %}
                        </div>
                    {% endif %}
                {% else %}
                    <div><strong>{{ current_user.username }}</strong></div>
                    <div style="color: #ff9800; font-size: 11px;">権限が設定されていません</div>
                {% endif %}
            {% else %}
                <div style="color: #999;">ゲスト</div>
            {% endif %}
        </div>
    </div>

    <div class="sidebar-menu">
        <!-- General User Menu (All authenticated users) -->
        {% if session.get('company_id') or session.get('is_super_admin') %}
            <div class="menu-section">
                <div class="menu-section-title">マニュアル</div>
                <a href="/manual/list" class="menu-item">
                    <span class="material-icons">list</span>
                    <span>マニュアル一覧</span>
                </a>
                <a href="/manuals/create" class="menu-item" style="background: rgba(76, 175, 80, 0.15); border-left: 3px solid #4caf50;">
                    <span class="material-icons">auto_awesome</span>
                    <span>マニュアル作成</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">リソース</div>
                <a href="/materials" class="menu-item">
                    <span class="material-icons">folder_open</span>
                    <span>学習資料</span>
                </a>
                <a href="/media/library" class="menu-item">
                    <span class="material-icons">perm_media</span>
                    <span>メディア管理</span>
                </a>
            </div>
        {% endif %}

        <!-- Company Admin Menu -->
        {% if session.get('company_id') and (session.get('user_role') == 'admin' or session.get('user_role') == 'super_admin' or session.get('is_super_admin')) %}
            <div class="menu-section">
                <div class="menu-section-title">企業管理者</div>
                <a href="/company/dashboard" class="menu-item">
                    <span class="material-icons">analytics</span>
                    <span>企業ダッシュボード</span>
                </a>
                <a href="/company/users" class="menu-item">
                    <span class="material-icons">group</span>
                    <span>ユーザー管理</span>
                </a>
                <a href="/company/templates" class="menu-item">
                    <span class="material-icons">description</span>
                    <span>テンプレート管理</span>
                </a>
            </div>
        {% endif %}

        <!-- Super Admin Menu -->
        {% if session.get('is_super_admin') %}
            <div class="menu-section">
                <div class="menu-section-title">スーパー管理者</div>
                <a href="/super-admin/dashboard" class="menu-item">
                    <span class="material-icons">dashboard</span>
                    <span>ダッシュボード</span>
                </a>
                <a href="/super-admin/companies" class="menu-item">
                    <span class="material-icons">business</span>
                    <span>企業管理</span>
                </a>
                <a href="/super-admin/users" class="menu-item">
                    <span class="material-icons">people</span>
                    <span>ユーザー管理</span>
                </a>
                <a href="/super-admin/activity-logs" class="menu-item">
                    <span class="material-icons">history</span>
                    <span>活動ログ</span>
                </a>
            </div>
        {% endif %}
    </div>

    <div class="sidebar-footer">
        {% if current_user.is_authenticated %}
            <form id="logout-form" action="/auth/logout" method="POST" style="margin: 0;">
                <button type="submit" class="menu-item" style="background: rgba(244, 67, 54, 0.2); border-radius: 5px; width: 100%; border: none; cursor: pointer;">
                    <span class="material-icons">logout</span>
                    <span>ログアウト</span>
                </button>
            </form>
        {% else %}
            <a href="/login" class="menu-item" style="background: rgba(76, 175, 80, 0.2); border-radius: 5px;">
                <span class="material-icons">login</span>
                <span>ログイン</span>
            </a>
        {% endif %}
    </div>
</div>
